{% extends 'base.html' %}

{% block title %}Seat Availability - Trainman{% endblock %}

{% block content %}
<!-- Seat Availability Header -->
<section class="hero">
    <div class="container">
        <h1>Seat Availability</h1>
        <p>Check seat availability before booking your ticket</p>
    </div>
</section>

<!-- Seat Availability Container -->
<div class="container">
    <div class="availability-container">
        <h2 class="availability-heading">Check Seat Availability</h2>
        
        <form id="availability-form" class="availability-form" action="{{ url_for('check_availability') }}" method="POST">
            <div class="form-row">
                <div class="form-group">
                    <label for="train-number">Train Number</label>
                    <input type="text" id="train-number" name="train_number" class="form-control" value="{{ train.number if train else '' }}" placeholder="Enter train number" required>
                </div>
                <div class="form-group">
                    <label for="from-station">From</label>
                    <input type="text" id="from-station" name="from_station" class="form-control station-input" value="{{ from_station if from_station else '' }}" placeholder="Enter source station" required>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="to-station">To</label>
                    <input type="text" id="to-station" name="to_station" class="form-control station-input" value="{{ to_station if to_station else '' }}" placeholder="Enter destination station" required>
                </div>
                <div class="form-group">
                    <label for="travel-date">Date</label>
                    <input type="date" id="travel-date" name="date" class="form-control" value="{{ date if date else '' }}" required>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="travel-class">Class</label>
                    <select id="travel-class" name="class" class="form-control" required>
                        <option value="SL" {% if train_class == 'SL' %}selected{% endif %}>Sleeper (SL)</option>
                        <option value="3A" {% if train_class == '3A' %}selected{% endif %}>AC 3 Tier (3A)</option>
                        <option value="2A" {% if train_class == '2A' %}selected{% endif %}>AC 2 Tier (2A)</option>
                        <option value="1A" {% if train_class == '1A' %}selected{% endif %}>AC First Class (1A)</option>
                        <option value="CC" {% if train_class == 'CC' %}selected{% endif %}>Chair Car (CC)</option>
                        <option value="EC" {% if train_class == 'EC' %}selected{% endif %}>Executive Chair Car (EC)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>&nbsp;</label>
                    <button type="submit" class="search-btn">
                        <i class="fas fa-search"></i> Check Availability
                    </button>
                </div>
            </div>
        </form>
        
        {% if availability %}
            <div class="availability-result">
                <h3>Seat Availability for {% if train %}{{ train.name }} ({{ train.number }}){% else %}Train{% endif %}</h3>
                <h4>{{ from_station }} to {{ to_station }} | Class: {{ train_class }}</h4>
                
                <table class="availability-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Status</th>
                            <th>Fare</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in availability %}
                            <tr>
                                <td>{{ item.date }}</td>
                                <td class="availability-status 
                                    {% if 'AVAILABLE' in item.status %}status-available
                                    {% elif 'RAC' in item.status %}status-rac
                                    {% elif 'WL' in item.status %}status-wl{% endif %}">
                                    {{ item.status }}
                                </td>
                                <td>{{ item.fare }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
                
                <div class="availability-note">
                    <p><strong>Note:</strong> Availability shown is subject to the current reservation system status and may change.</p>
                </div>
            </div>
        {% elif train %}
            <div class="train-info-section">
                <h3>Train Information</h3>
                <div class="train-detail">
                    <div class="train-name">{{ train.name }}</div>
                    <div class="train-number">Train #{{ train.number }}</div>
                    <div class="train-route">{{ train.from }} - {{ train.to }}</div>
                    <div class="train-time">{{ train.departure }} - {{ train.arrival }} ({{ train.duration }})</div>
                </div>
                
                <p class="availability-prompt">
                    Please fill in the form above and click "Check Availability" to see seat availability for this train.
                </p>
            </div>
        {% else %}
            <div class="availability-info">
                <h3>How to Check Seat Availability</h3>
                <ul>
                    <li>Enter train number, source, destination, date and class</li>
                    <li>Click on "Check Availability" button</li>
                    <li>View the seat availability status for next few days</li>
                </ul>
                
                <div class="availability-legend">
                    <h4>Status Legend</h4>
                    <p><span class="status-available">AVAILABLE-XX</span> - XX seats are available</p>
                    <p><span class="status-rac">RAC-XX</span> - Reservation Against Cancellation, XX seats in RAC</p>
                    <p><span class="status-wl">WL-XX</span> - Waitlist, XX passengers in waiting</p>
                </div>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}
